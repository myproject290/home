<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Tax Calculator FY 2025-26</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: "Calibri", "Arial", sans-serif;
            background-color: #525659;
            margin: 0;
            padding-top: 10px;
            padding-bottom: 10px;
            display: block; 
            text-align: center;
        }

        .no-print {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            padding: 8px 15px;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-print { background-color: #28a745; }
        .btn-print:hover { background-color: #218838; }

        /* New Share Button Style */
        .btn-share { background-color: #007bff; }
        .btn-share:hover { background-color: #0069d9; }

        .btn-reset { background-color: #dc3545; }
        .btn-reset:hover { background-color: #c82333; }

        .sheet {
            background-color: white;
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 12mm; 
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            box-sizing: border-box;
            display: inline-block; 
            text-align: left;
            margin: 0 auto;
            position: relative;
            margin-top: 40px; /* Added margin for top bar */
        }

        /* Typography */
        h2 { font-size: 14pt; font-weight: bold; text-align: center; margin: 0 0 5px 0; }
        h3 { font-size: 13pt; font-weight: normal; color: blue; margin: 0 0 15px 0; }

        /* Table Structure */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12.5pt; 
            table-layout: fixed;
        }

        .info-table { margin-bottom: 15px; }
        .calc-table { margin-bottom: 0; }
        .summary-table { margin-top: -1px; }

        th, td {
            border: 1px solid black;
            padding: 2px 4px; 
            vertical-align: middle;
            line-height: 1.5; 
            overflow: hidden;
            white-space: nowrap; 
        }
        
        td.wrap-text { white-space: normal; }
        .center { text-align: center; }
        .right { text-align: right; white-space: nowrap; }
        .bold { font-weight: bold; }

        /* General Input Style */
        input {
            width: 100%;
            border: none;
            font-family: inherit;
            font-size: inherit;
            background: transparent;
            outline: none;
            padding: 0;
            margin: 0;
            color: #000;
            line-height: 1.5;
            font-weight: bold;
            transition: font-size 0.1s;
        }

        textarea {
            width: 100%;
            border: none;
            font-family: inherit;
            font-size: inherit;
            background: transparent;
            outline: none;
            padding: 0;
            margin: 0;
            color: #000;
            resize: none; 
            overflow: hidden; 
            min-height: 25px;
            display: block;
            line-height: 1.5;
            font-weight: bold;
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        input[type=number] { -moz-appearance: textfield; }

        .upper { text-transform: uppercase; }
        .capitalize { text-transform: capitalize; }
        .input-bg { background-color: #ffffe6; }
        input.input-bg, textarea.input-bg { background-color: #ffffe6; }

        .col-idx { text-align: center; font-weight: bold; width: 5%; }
        
        /* Footer */
        .footer {
            margin-top: 45px; 
            display: flex;
            justify-content: space-between;
            font-size: 12.5pt;
            width: 100%;
        }
        .signature-line {
            border-top: 1px dashed black;
            width: 220px;
            text-align: center;
            padding-top: 5px;
        }

        /* Loader */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 20000;
            color: white;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: none; padding: 0; margin: 0; }
            .no-print { display: none; }
            .sheet { box-shadow: none; width: 100%; min-height: 297mm; margin: 0; padding: 10mm 15mm; border: none; }
            .input-bg { background-color: transparent !important; }
            input, textarea { background-color: transparent !important; font-weight: bold; }
        }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div style="margin-bottom: 10px;">Generating PDF...</div>
    <div>Please wait</div>
</div>

<div class="no-print">
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
    <button class="btn-share" onclick="sharePDF()">üì± Share as PDF</button>
    <button class="btn-reset" onclick="resetForm()">üîÑ Reset</button>
</div>

<div class="sheet" id="printContent">
    <h2>Income Tax Calculation for the Financial Year 2025-26 (AY 2026-27)</h2>
    <h3>Regime opted >>>> New regime</h3>

    <table class="info-table">
        <colgroup>
            <col style="width: 20%;"> <col style="width: 35%;"> <col style="width: 15%;"> <col style="width: 30%;">
        </colgroup>
        <tr>
            <td>Name and Desig.</td>
            <td><textarea class="capitalize" rows="1" oninput="autoResize(this)"></textarea></td>
            <td>PAN</td>
            <td><input type="text" class="upper"></td>
        </tr>
        <tr>
            <td>e-Salary Code</td>
            <td><textarea class="upper" rows="1" oninput="autoResize(this)"></textarea></td>
            <td>Mobile No.</td>
            <td><input type="number"></td>
        </tr>
        <tr>
            <td>Office Address</td>
            <td><textarea class="capitalize" rows="1" oninput="autoResize(this)"></textarea></td>
            <td>Category</td>
            <td>Gen. Public</td>
        </tr>
    </table>

    <table class="calc-table">
        <colgroup>
            <col style="width: 5%;"> <col style="width: 30%;"> <col style="width: 13%;"> <col style="width: 13%;"> <col style="width: 13%;"> <col style="width: 11%;"> <col style="width: 15%;">
        </colgroup>

        <tr>
            <td class="col-idx">1.</td>
            <td colspan="5" class="wrap-text">Income from salary</td>
            <td class="right input-bg">
                <input type="text" inputmode="numeric" id="grossIncome" class="right input-bg" placeholder="0" oninput="formatInput(this)">
            </td>
        </tr>
        <tr>
            <td class="col-idx">2.</td>
            <td colspan="5" class="wrap-text">Standard deduction u/s 16(ia)</td>
            <td class="right">75,000</td>
        </tr>
        <tr>
            <td class="col-idx">3.</td>
            <td colspan="5" class="wrap-text">Income under the head Salaries</td>
            <td class="right" id="headSalaries">0</td>
        </tr>
        <tr>
            <td class="col-idx">4.</td>
            <td colspan="5" class="wrap-text">Taxable Income</td>
            <td class="right bold" id="taxableIncome">0</td>
        </tr>
        
        <tr>
            <td rowspan="9" class="col-idx" id="slab-idx-cell" style="vertical-align: middle;">5.</td>
            <td rowspan="9" class="wrap-text" id="slab-title-cell" style="vertical-align: middle; text-align: center; font-weight:bold;">
                Income Tax Liability
            </td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">from Rs.</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">to Rs.</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Income</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Rate</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Income Tax</td>
        </tr>

        <tr id="row-slab-1">
            <td class="right">0</td>
            <td class="right" id="to-slab-1">4,00,000</td>
            <td class="right" id="inc-slab-1">0</td>
            <td class="center">0 %</td>
            <td class="right" id="tax-slab-1">0</td>
        </tr>
        <tr id="row-slab-2">
            <td class="right">4,00,001</td>
            <td class="right" id="to-slab-2">8,00,000</td>
            <td class="right" id="inc-slab-2">0</td>
            <td class="center">5 %</td>
            <td class="right" id="tax-slab-2">0</td>
        </tr>
        <tr id="row-slab-3">
            <td class="right">8,00,001</td>
            <td class="right" id="to-slab-3">12,00,000</td>
            <td class="right" id="inc-slab-3">0</td>
            <td class="center">10 %</td>
            <td class="right" id="tax-slab-3">0</td>
        </tr>
        <tr id="row-slab-4">
            <td class="right">12,00,001</td>
            <td class="right" id="to-slab-4">16,00,000</td>
            <td class="right" id="inc-slab-4">0</td>
            <td class="center">15 %</td>
            <td class="right" id="tax-slab-4">0</td>
        </tr>
        <tr id="row-slab-5">
            <td class="right">16,00,001</td>
            <td class="right" id="to-slab-5">20,00,000</td>
            <td class="right" id="inc-slab-5">0</td>
            <td class="center">20 %</td>
            <td class="right" id="tax-slab-5">0</td>
        </tr>
        <tr id="row-slab-6">
            <td class="right">20,00,001</td>
            <td class="right" id="to-slab-6">24,00,000</td>
            <td class="right" id="inc-slab-6">0</td>
            <td class="center">25 %</td>
            <td class="right" id="tax-slab-6">0</td>
        </tr>
        <tr id="row-slab-7">
            <td class="right">24,00,001</td>
            <td class="right" id="to-slab-7">Above</td>
            <td class="right" id="inc-slab-7">0</td>
            <td class="center">30 %</td>
            <td class="right" id="tax-slab-7">0</td>
        </tr>
        <tr>
            <td colspan="4" class="right bold">Total Income Tax</td>
            <td class="right bold" id="totalSlabTax">0</td>
        </tr>

        <tr>
            <td class="col-idx">6.</td>
            <td colspan="5" class="wrap-text">Relief under section 87A (Subject to maximum Rs.60000)</td>
            <td class="right" id="rebate87A">0</td>
        </tr>
        <tr>
            <td class="col-idx">7.</td>
            <td colspan="5" class="wrap-text">Marginal relief (u/s 87A for income slightly above 12L)</td>
            <td class="right" id="marginalRelief87A">0</td>
        </tr>
        <tr>
            <td class="col-idx">8.</td>
            <td colspan="5" class="wrap-text">Income Tax after relief u/s 87A (5 - 6 - 7)</td>
            <td class="right bold" id="taxAfterRelief">0</td>
        </tr>
        
        <tr>
            <td class="col-idx">9.</td>
            <td colspan="5" class="wrap-text">Add: Surcharge (10% > 50L, 15% > 1Cr, 25% > 2Cr)</td>
            <td class="right" id="surcharge">0</td>
        </tr>
        <tr>
            <td class="col-idx">10.</td>
            <td colspan="5" class="wrap-text">Less: Marginal relief on Surcharge</td>
            <td class="right" id="marginalReliefSurcharge">0</td>
        </tr>
        <tr>
            <td class="col-idx">11.</td>
            <td colspan="5" class="wrap-text">Education cess and Health cess @ 4%</td>
            <td class="right" id="cess">0</td>
        </tr>
        <tr>
            <td class="col-idx">12.</td>
            <td colspan="5" class="bold wrap-text">Total Income Tax</td>
            <td class="right bold" id="totalTaxLiability">0</td>
        </tr>
        <tr>
            <td class="col-idx">13.</td>
            <td colspan="5" class="wrap-text">Relief under section 89(1) if any (attach form 10E)</td>
            <td class="right input-bg">
                <input type="text" inputmode="numeric" id="relief89" class="right input-bg" placeholder="0" oninput="formatInput(this)">
            </td>
        </tr>
    </table>

    <table class="summary-table">
        <colgroup>
            <col style="width: 5%;"> <col style="width: 35%;"> <col style="width: 15%;"> <col style="width: 15%;"> <col style="width: 15%;"> <col style="width: 15%;">
        </colgroup>
        <tr>
            <td colspan="3" style="border-left: none;"></td> 
            <td class="center bold" style="background-color: #f0fff0;">Tax</td>
            <td class="center bold" style="background-color: #f0fff0;">Cess</td>
            <td class="center bold" style="background-color: #f0fff0;">Total</td>
        </tr>
        <tr>
            <td class="col-idx">14.</td>
            <td colspan="2" class="wrap-text">Balance Income Tax payable after relief</td>
            <td class="right" id="balanceTaxComp">0</td>
            <td class="right" id="balanceCessComp">0</td>
            <td class="right" id="balanceTotalComp">0</td>
        </tr>
        <tr>
            <td class="col-idx">15.</td>
            <td colspan="2" class="wrap-text">Income Tax already paid</td>
            <td class="right input-bg"><input type="text" inputmode="numeric" id="paidTax" class="right input-bg" placeholder="0" oninput="formatInput(this)"></td>
            <td class="right input-bg"><input type="text" inputmode="numeric" id="paidCess" class="right input-bg" placeholder="0" oninput="formatInput(this)"></td>
            <td class="right" id="paidTotal">0</td>
        </tr>
        <tr>
            <td class="col-idx">16.</td>
            <td class="bold wrap-text">Net Income Tax</td>
            <td style="background-color: #fafafa;">
                <input type="text" id="taxStatus" class="bold center" readonly value="Nil" style="width: 100%;">
            </td>
            <td class="right bold" id="netTax">0</td>
            <td class="right bold" id="netCess">0</td>
            <td class="right bold" id="netTotal">0</td>
        </tr>
    </table>

    <div class="footer">
        <div>Dated: <span id="currentDate"></span></div>
        <div class="signature-line">Signature</div>
    </div>
</div>

<script>
    // --- RESET Function ---
    function resetForm() {
        if(confirm("Are you sure you want to clear all data?")) {
            let inputs = document.querySelectorAll("input, textarea");
            inputs.forEach(input => {
                input.value = "";
                if (input.tagName === "TEXTAREA") {
                    input.style.height = "auto";
                }
                if(input.style.fontSize) input.style.fontSize = "inherit";
            });
            document.querySelectorAll("td[id]").forEach(td => {
                td.style.fontSize = "inherit";
            });
            calculateTax();
        }
    }

    // --- SHARE AS PDF Function ---
    async function sharePDF() {
        const overlay = document.getElementById('loadingOverlay');
        overlay.style.display = 'flex';

        // --- FIX: Force capitalization logic on the values for Canvas ---
        // html2canvas reads the actual value, so we must manually capitalize the text
        // based on the CSS class applied to the input/textarea.
        const inputs = document.querySelectorAll('#printContent input, #printContent textarea');
        inputs.forEach(input => {
            if (input.classList.contains('upper')) {
                input.value = input.value.toUpperCase();
            } else if (input.classList.contains('capitalize')) {
                // Capitalize first letter of each word
                input.value = input.value.replace(/\b\w/g, l => l.toUpperCase());
            }
        });
        // ---------------------------------------------------------------

        try {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('printContent');
            
            // Capture the content as a canvas with high scale for HD quality
            const canvas = await html2canvas(element, {
                scale: 2, // 2x scale ensures HD quality without being too heavy
                useCORS: true,
                backgroundColor: "#ffffff"
            });

            // Convert canvas to JPEG (Smaller size than PNG)
            // Quality 0.75 is the sweet spot for 700kb-1000kb range
            const imgData = canvas.toDataURL('image/jpeg', 0.75);

            // Create A4 PDF
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            
            // Calculate ratios to fit image on A4
            const imgProps = pdf.getImageProperties(imgData);
            const pdfHeight = (imgProps.height * pageWidth) / imgProps.width;

            // Add image to PDF
            pdf.addImage(imgData, 'JPEG', 0, 0, pageWidth, pdfHeight);

            // Generate Blob for sharing
            const pdfBlob = pdf.output('blob');
            const fileName = "IncomeTax_Calculation_" + new Date().getFullYear() + ".pdf";
            const file = new File([pdfBlob], fileName, { type: "application/pdf" });

            // Trigger Share (Mobile) or Download (Desktop)
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({
                    files: [file],
                    title: 'Income Tax Calculation',
                    text: 'Here is the Income Tax Calculation sheet.',
                });
            } else {
                // Fallback for Desktop
                pdf.save(fileName);
            }

        } catch (error) {
            alert("Error generating PDF: " + error.message);
            console.error(error);
        } finally {
            overlay.style.display = 'none';
        }
    }

    function autoResize(elem) {
        elem.style.height = 'auto'; 
        elem.style.height = elem.scrollHeight + 'px';
    }

    function adjustFontSize(idOrElem) {
        let elem = (typeof idOrElem === 'string') ? document.getElementById(idOrElem) : idOrElem;
        if (!elem) return;

        let text = (elem.tagName === 'INPUT') ? elem.value : elem.innerText;
        let len = text.length;

        if (len > 11) {
            let newSize = 12.5 * (11 / len); 
            if (newSize < 6.5) newSize = 6.5; 
            elem.style.fontSize = newSize + "pt";
        } else {
            elem.style.fontSize = "inherit";
        }
    }

    function formatInput(elem) {
        let rawVal = elem.value.replace(/,/g, '');
        if (!rawVal || isNaN(rawVal)) {
             calculateTax();
             if(rawVal === "") elem.style.fontSize = "inherit";
             return;
        }
        let formatted = Math.round(rawVal).toLocaleString('en-IN');
        if (elem.value !== formatted) elem.value = formatted;
        adjustFontSize(elem);
        calculateTax();
    }

    function updateAndResize(id, value) {
        let elem = document.getElementById(id);
        if(!elem) return;
        elem.innerText = value;
        adjustFontSize(elem);
    }

    const d = new Date();
    document.getElementById('currentDate').innerText = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;

    function format(num) {
        return Math.round(num).toLocaleString('en-IN');
    }

    function calculateTax() {
        function getVal(id) {
            let elem = document.getElementById(id);
            if(!elem) return 0;
            let cleanVal = elem.value.replace(/,/g, '');
            return parseFloat(cleanVal) || 0;
        }

        let gross = getVal('grossIncome');
        let relief89 = getVal('relief89');
        let paidTaxVal = getVal('paidTax');
        let paidCessVal = getVal('paidCess');
        
        let stdDed = 75000;
        let taxable = gross - stdDed;
        if(taxable < 0) taxable = 0;

        updateAndResize('headSalaries', format(taxable));
        updateAndResize('taxableIncome', format(taxable));

        let slabs = [
            { start: 0, limit: 400000, rate: 0, id: 1 },
            { start: 400000, limit: 800000, rate: 0.05, id: 2 },
            { start: 800000, limit: 1200000, rate: 0.10, id: 3 },
            { start: 1200000, limit: 1600000, rate: 0.15, id: 4 },
            { start: 1600000, limit: 2000000, rate: 0.20, id: 5 },
            { start: 2000000, limit: 2400000, rate: 0.25, id: 6 },
            { start: 2400000, limit: Infinity, rate: 0.30, id: 7 }
        ];

        let slabTaxTotal = 0;
        let visibleRowsCount = 0;

        for(let i=0; i<slabs.length; i++) {
            let slab = slabs[i];
            let row = document.getElementById(`row-slab-${slab.id}`);
            let isRelevant = (taxable > slab.start) || (i === 0 && taxable >= 0);

            if (isRelevant) {
                row.style.display = 'table-row';
                visibleRowsCount++;

                let incomeInSlab = 0;
                if (slab.limit !== Infinity && taxable > slab.limit) {
                    incomeInSlab = slab.limit - slab.start;
                    updateAndResize(`to-slab-${slab.id}`, format(slab.limit));
                } else {
                    incomeInSlab = taxable - slab.start;
                    updateAndResize(`to-slab-${slab.id}`, format(taxable));
                }
                
                if (incomeInSlab < 0) incomeInSlab = 0;
                let taxInSlab = incomeInSlab * slab.rate;
                slabTaxTotal += taxInSlab;

                updateAndResize(`inc-slab-${slab.id}`, format(incomeInSlab));
                updateAndResize(`tax-slab-${slab.id}`, format(taxInSlab));
            } else {
                row.style.display = 'none';
            }
        }

        let newRowSpan = 2 + visibleRowsCount;
        document.getElementById('slab-idx-cell').rowSpan = newRowSpan;
        document.getElementById('slab-title-cell').rowSpan = newRowSpan;

        updateAndResize('totalSlabTax', format(slabTaxTotal));

        let rebate87A = 0;
        let marginalRelief87A = 0;
        let taxAfterRelief = slabTaxTotal;

        if (taxable <= 1200000) {
            rebate87A = slabTaxTotal;
            taxAfterRelief = 0;
        } else {
            let excessIncome = taxable - 1200000;
            if (slabTaxTotal > excessIncome) {
                marginalRelief87A = slabTaxTotal - excessIncome;
                taxAfterRelief = excessIncome;
            }
        }

        updateAndResize('rebate87A', format(rebate87A));
        updateAndResize('marginalRelief87A', format(marginalRelief87A));
        updateAndResize('taxAfterRelief', format(taxAfterRelief));

        let surchargeAmount = 0;
        let surchargeRate = 0;
        if (taxable > 20000000) surchargeRate = 0.25; 
        else if (taxable > 10000000) surchargeRate = 0.15;
        else if (taxable > 5000000) surchargeRate = 0.10;

        surchargeAmount = taxAfterRelief * surchargeRate;

        let surchargeRelief = 0;
        if (taxable > 5000000) {
            let limitIncome = 0;
            let limitSurchargeRate = 0;
            if (taxable > 20000000) { limitIncome = 20000000; limitSurchargeRate = 0.15; } 
            else if (taxable > 10000000) { limitIncome = 10000000; limitSurchargeRate = 0.10; } 
            else { limitIncome = 5000000; limitSurchargeRate = 0; }

            let totalTaxOnLimit = 0;
            if (limitIncome > 400000) totalTaxOnLimit += (Math.min(limitIncome, 800000) - 400000) * 0.05;
            if (limitIncome > 800000) totalTaxOnLimit += (Math.min(limitIncome, 1200000) - 800000) * 0.10;
            if (limitIncome > 1200000) totalTaxOnLimit += (Math.min(limitIncome, 1600000) - 1200000) * 0.15;
            if (limitIncome > 1600000) totalTaxOnLimit += (Math.min(limitIncome, 2000000) - 1600000) * 0.20;
            if (limitIncome > 2000000) totalTaxOnLimit += (Math.min(limitIncome, 2400000) - 2000000) * 0.25;
            if (limitIncome > 2400000) totalTaxOnLimit += (limitIncome - 2400000) * 0.30;
            
            let surchargeOnLimit = totalTaxOnLimit * limitSurchargeRate;
            let totalLimitLiab = totalTaxOnLimit + surchargeOnLimit;
            let incomeExcess = taxable - limitIncome;
            let maxTaxPayable = totalLimitLiab + incomeExcess;
            
            let totalActualTax = taxAfterRelief + surchargeAmount;
            if (totalActualTax > maxTaxPayable) {
                surchargeRelief = totalActualTax - maxTaxPayable;
            }
        }

        updateAndResize('surcharge', format(surchargeAmount));
        updateAndResize('marginalReliefSurcharge', format(surchargeRelief));

        let taxBeforeCess = taxAfterRelief + surchargeAmount - surchargeRelief;
        let cess = Math.round(taxBeforeCess * 0.04);
        updateAndResize('cess', format(cess));

        let totalLiab = taxBeforeCess + cess;
        updateAndResize('totalTaxLiability', format(totalLiab));

        let finalTaxComp = taxBeforeCess;
        let finalCessComp = cess;
        if (relief89 > 0) {
            let remainRelief = relief89;
            if (remainRelief <= finalTaxComp) { finalTaxComp -= remainRelief; remainRelief = 0; } 
            else { remainRelief -= finalTaxComp; finalTaxComp = 0; 
                if (remainRelief <= finalCessComp) { finalCessComp -= remainRelief; } else { finalCessComp = 0; }
            }
        }
        
        let totalPayable = finalTaxComp + finalCessComp;
        updateAndResize('balanceTaxComp', format(finalTaxComp));
        updateAndResize('balanceCessComp', format(finalCessComp));
        updateAndResize('balanceTotalComp', format(totalPayable));

        let paidTotal = paidTaxVal + paidCessVal;
        updateAndResize('paidTotal', format(paidTotal));

        let netTax = finalTaxComp - paidTaxVal;
        let netCess = finalCessComp - paidCessVal;
        let netTotal = totalPayable - paidTotal;

        updateAndResize('netTax', format(netTax));
        updateAndResize('netCess', format(netCess));
        updateAndResize('netTotal', format(netTotal));

        let statusBox = document.getElementById('taxStatus');
        if (netTotal > 0) {
            statusBox.value = "Payable";
            statusBox.style.color = "#dc3545";
        } else if (netTotal < 0) {
            statusBox.value = "Refundable";
            statusBox.style.color = "#28a745";
        } else {
            statusBox.value = "Nil";
            statusBox.style.color = "black";
        }
    }
    
    calculateTax();
    adjustFontSize('grossIncome');
</script>

</body>
</html>
