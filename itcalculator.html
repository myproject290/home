<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Tax Calculator FY 2025-26</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: "Calibri", "Arial", sans-serif;
            background-color: #525659;
            margin: 0;
            padding-top: 10px;
            padding-bottom: 10px;
            display: block; 
            text-align: center;
        }

        .no-print {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            padding: 8px 15px;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-print { background-color: #28a745; }
        .btn-share { background-color: #007bff; }
        .btn-download { background-color: #6f42c1; }
        .btn-reset { background-color: #dc3545; display: none; }

        .sheet {
            background-color: white;
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 12mm; 
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            box-sizing: border-box;
            display: inline-block; 
            text-align: left;
            margin: 40px auto 0 auto;
            position: relative;
        }

        h2 { font-size: 14pt; font-weight: bold; text-align: center; margin: 0 0 5px 0; }
        h3 { font-size: 13pt; font-weight: normal; color: blue; margin: 0 0 15px 0; text-align: center; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12.5pt; 
            table-layout: fixed;
        }

        .info-table { margin-bottom: 15px; }
        th, td {
            border: 1px solid black;
            padding: 1.7px 4px; 
            vertical-align: middle;
            line-height: 1.5; 
            overflow: hidden;
        }
        
        td.wrap-text { white-space: normal; }
        .center { text-align: center; }
        .right { text-align: right; white-space: nowrap; }
        .bold { font-weight: bold; }

        input, textarea {
            width: 100%;
            border: none;
            font-family: inherit;
            font-size: inherit;
            background: transparent;
            outline: none;
            padding: 0;
            margin: 0;
            color: #000;
            line-height: 1.5;
            font-weight: bold;
        }

        textarea { resize: none; overflow: hidden; min-height: 25px; display: block; }
        
        /* eSalary no-wrap */
        #eSalaryCode { white-space: nowrap !important; }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        .upper { text-transform: uppercase; }
        .capitalize { text-transform: capitalize; }
        .input-bg { background-color: #ffffe6; }

        .col-idx { text-align: center; font-weight: bold; width: 5%; }
        
        .footer {
            margin-top: 35px; 
            display: flex;
            justify-content: space-between;
            font-size: 12.5pt;
            width: 100%;
        }
        .signature-line {
            border-top: 1px dashed black;
            width: 180px;
            text-align: center;
            padding-top: 5px;
        }

        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 20000;
            color: white;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        @media print {
            @page { size: A4; margin: 0; }
            body { background: none; padding: 0; margin: 0; }
            .no-print { display: none; }
            .sheet { box-shadow: none; width: 100%; min-height: 297mm; margin: 0; padding: 10mm 15mm 0 15mm; border: none; }
            .input-bg { background-color: transparent !important; }
        }
    </style>
</head>
<body oninput="checkInputs()">

<div id="loadingOverlay">
    <div style="margin-bottom: 10px;">Generating PDF...</div>
    <div>Please wait</div>
</div>

<div class="no-print">
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
    <button class="btn-share" onclick="sharePDF()">üì± Share as PDF</button>
    <button class="btn-download" onclick="downloadPDF()">üìÑ Download PDF</button>
    <button id="resetBtn" class="btn-reset" onclick="resetForm()">üîÑ Reset</button>
</div>

<div class="sheet" id="printContent">
    <h2>Income Tax Calculation for the Financial Year 2025-26 (AY 2026-27)</h2>
    <h3>Tax Regime Opted: New Regime</h3>

    <table class="info-table">
        <colgroup>
            <col style="width: 20%;"> <col style="width: 35%;"> <col style="width: 15%;"> <col style="width: 30%;">
        </colgroup>
        <tr>
            <td>Name and Desig.</td>
            <td>
                <textarea id="user_name" tabindex="1" class="capitalize nav-input" data-next="eSalaryCode" rows="1" oninput="autoResize(this); updateTitle(this)"></textarea>
            </td>
            <td>PAN</td>
            <td>
                <input type="text" id="pan_no" tabindex="4" class="upper nav-input" data-next="mobile_no" maxlength="10" oninput="validatePAN(this)">
            </td>
        </tr>
        <tr>
            <td>e-Salary Code</td>
            <td>
                <textarea id="eSalaryCode" tabindex="2" class="upper nav-input" data-next="office_addr" rows="1" oninput="this.value = this.value.toUpperCase(); autoResize(this);"></textarea>
            </td>
            <td>Mobile No.</td>
            <td>
                <input type="text" id="mobile_no" tabindex="5" class="nav-input" data-next="grossIncome" maxlength="10" oninput="validateMobile(this)">
            </td>
        </tr>
        <tr>
            <td>Office Address</td>
            <td>
                <textarea id="office_addr" tabindex="3" class="capitalize nav-input" data-next="pan_no" rows="1" oninput="autoResize(this)"></textarea>
            </td>
            <td>Category</td>
            <td>Gen. Public</td>
        </tr>
    </table>

    <table class="calc-table">
        <colgroup>
            <col style="width: 5%;"> <col style="width: 30%;"> <col style="width: 13%;"> <col style="width: 13%;"> <col style="width: 13%;"> <col style="width: 11%;"> <col style="width: 15%;">
        </colgroup>

        <tr>
            <td class="col-idx">1.</td>
            <td colspan="5" class="wrap-text">Income from salary</td>
            <td class="right input-bg">
                <input type="text" inputmode="numeric" id="grossIncome" tabindex="6" class="right input-bg nav-input" data-next="relief89" oninput="formatInput(this)">
            </td>
        </tr>
        <tr><td class="col-idx">2.</td><td colspan="5" class="wrap-text">Standard deduction u/s 16(ia)</td><td class="right">75,000</td></tr>
        <tr><td class="col-idx">3.</td><td colspan="5" class="wrap-text">Income under the head Salaries</td><td class="right" id="headSalaries">0</td></tr>
        <tr><td class="col-idx">4.</td><td colspan="5" class="wrap-text">Taxable Income</td><td class="right bold" id="taxableIncome">0</td></tr>
        
        <tr>
            <td rowspan="9" class="col-idx" id="slab-idx-cell">5.</td>
            <td rowspan="9" class="wrap-text" id="slab-title-cell" style="text-align: center; font-weight:bold;">Income Tax Liability</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">from Rs.</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">to Rs.</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Income</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Rate</td>
            <td class="center bold" style="background:#f9f9f9; font-size:11.5pt;">Income Tax</td>
        </tr>
        <tr id="row-slab-1"><td class="right">0</td><td class="right" id="to-slab-1">4,00,000</td><td class="right" id="inc-slab-1">0</td><td class="center">0 %</td><td class="right" id="tax-slab-1">0</td></tr>
        <tr id="row-slab-2"><td class="right">4,00,001</td><td class="right" id="to-slab-2">8,00,000</td><td class="right" id="inc-slab-2">0</td><td class="center">5 %</td><td class="right" id="tax-slab-2">0</td></tr>
        <tr id="row-slab-3"><td class="right">8,00,001</td><td class="right" id="to-slab-3">12,00,000</td><td class="right" id="inc-slab-3">0</td><td class="center">10 %</td><td class="right" id="tax-slab-3">0</td></tr>
        <tr id="row-slab-4"><td class="right">12,00,001</td><td class="right" id="to-slab-4">16,00,000</td><td class="right" id="inc-slab-4">0</td><td class="center">15 %</td><td class="right" id="tax-slab-4">0</td></tr>
        <tr id="row-slab-5"><td class="right">16,00,001</td><td class="right" id="to-slab-5">20,00,000</td><td class="right" id="inc-slab-5">0</td><td class="center">20 %</td><td class="right" id="tax-slab-5">0</td></tr>
        <tr id="row-slab-6"><td class="right">20,00,001</td><td class="right" id="to-slab-6">24,00,000</td><td class="right" id="inc-slab-6">0</td><td class="center">25 %</td><td class="right" id="tax-slab-6">0</td></tr>
        <tr id="row-slab-7"><td class="right">24,00,001</td><td class="right" id="to-slab-7">Above</td><td class="right" id="inc-slab-7">0</td><td class="center">30 %</td><td class="right" id="tax-slab-7">0</td></tr>
        <tr><td colspan="4" class="right bold">Total Income Tax</td><td class="right bold" id="totalSlabTax">0</td></tr>

        <tr><td class="col-idx">6.</td><td colspan="5" class="wrap-text">Relief under section 87A</td><td class="right" id="rebate87A">0</td></tr>
        <tr><td class="col-idx">7.</td><td colspan="5" class="wrap-text">Marginal relief (u/s 87A)</td><td class="right" id="marginalRelief87A">0</td></tr>
        <tr><td class="col-idx">8.</td><td colspan="5" class="wrap-text">Tax after relief u/s 87A</td><td class="right bold" id="taxAfterRelief">0</td></tr>
        <tr><td class="col-idx">9.</td><td colspan="5" class="wrap-text">Surcharge</td><td class="right" id="surcharge">0</td></tr>
        <tr><td class="col-idx">10.</td><td colspan="5" class="wrap-text">Marginal relief on Surcharge</td><td class="right" id="marginalReliefSurcharge">0</td></tr>
        <tr><td class="col-idx">11.</td><td colspan="5" class="wrap-text">Tax after Marginal relief</td><td class="right bold" id="taxAfterSurchargeRelief">0</td></tr>
        <tr><td class="col-idx">12.</td><td colspan="5" class="wrap-text">Cess @ 4%</td><td class="right" id="cess">0</td></tr>
        <tr><td class="col-idx">13.</td><td colspan="5" class="bold wrap-text">Total Income Tax</td><td class="right bold" id="totalTaxLiability">0</td></tr>
        <tr>
            <td class="col-idx">14.</td>
            <td colspan="5" class="wrap-text">Relief under section 89(1)</td>
            <td class="right input-bg">
                <input type="text" inputmode="numeric" id="relief89" tabindex="7" class="right input-bg nav-input" data-next="paidTax" oninput="formatInput(this)">
            </td>
        </tr>
    </table>

    <table class="summary-table">
        <colgroup><col style="width: 5%;"><col style="width: 35%;"><col style="width: 15%;"><col style="width: 15%;"><col style="width: 15%;"><col style="width: 15%;"></colgroup>
        <tr><td colspan="3"></td><td class="center bold">Tax</td><td class="center bold">Cess</td><td class="center bold">Total</td></tr>
        <tr><td class="col-idx">15.</td><td colspan="2">Balance Payable</td><td class="right" id="balanceTaxComp">0</td><td class="right" id="balanceCessComp">0</td><td class="right" id="balanceTotalComp">0</td></tr>
        <tr>
            <td class="col-idx">16.</td>
            <td colspan="2">Tax already paid</td>
            <td class="right input-bg"><input type="text" inputmode="numeric" id="paidTax" tabindex="8" class="right input-bg nav-input" data-next="paidCess" oninput="formatInput(this)"></td>
            <td class="right input-bg"><input type="text" inputmode="numeric" id="paidCess" tabindex="9" class="right input-bg" oninput="formatInput(this)"></td>
            <td class="right" id="paidTotal">0</td>
        </tr>
        <tr>
            <td class="col-idx">17.</td>
            <td class="bold">Net Income Tax</td>
            <td style="background-color: #fafafa;"><input type="text" id="taxStatus" class="bold center" readonly value="Nil"></td>
            <td class="right bold" id="netTax">0</td><td class="right bold" id="netCess">0</td><td class="right bold" id="netTotal">0</td>
        </tr>
    </table>

    <div class="footer">
        <div>Dated: <span id="currentDate"></span></div>
        <div class="signature-line">Signature</div>
    </div>
</div>

<script>
    // ENTER KEY NAVIGATION Logic
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const current = document.activeElement;
            if (current.classList.contains('nav-input')) {
                e.preventDefault();
                const nextId = current.getAttribute('data-next');
                if (nextId) {
                    const nextElem = document.getElementById(nextId);
                    if (nextElem) {
                        nextElem.focus();
                    }
                }
            }
        }
    });

    // PAN RULES: 4 Alpha -> 4 Digit -> 1 Alpha
    function validatePAN(input) {
        let val = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        let corrected = "";
        for (let i = 0; i < val.length; i++) {
            if (i < 5) { // 0-4 Alphabets
                if (/[A-Z]/.test(val[i])) corrected += val[i];
            } else if (i >= 5 && i < 9) { // 5-8 Digits
                if (/[0-9]/.test(val[i])) corrected += val[i];
            } else if (i === 9) { // 9 Alphabet
                if (/[A-Z]/.test(val[i])) corrected += val[i];
            }
        }
        input.value = corrected;
    }

    // MOBILE RULES: No leading 0, 10 digits
    function validateMobile(input) {
        let val = input.value.replace(/\D/g, '');
        if (val.startsWith('0')) val = val.substring(1);
        input.value = val.substring(0, 10);
    }

    function checkInputs() {
        let hasValue = Array.from(document.querySelectorAll("input, textarea")).some(i => !i.readOnly && i.value.trim() !== "");
        document.getElementById("resetBtn").style.display = hasValue ? "inline-flex" : "none";
    }

    function resetForm() {
        document.querySelectorAll("input, textarea").forEach(i => { i.value = ""; i.style.height = "auto"; });
        calculateTax(); checkInputs();
    }

    function autoResize(elem) {
        elem.style.height = 'auto'; 
        elem.style.height = elem.scrollHeight + 'px';
    }

    function updateTitle(elem) {
        document.title = elem.value.trim() || "Income Tax Calculator FY 2025-26";
    }

    function formatInput(elem) {
        let rawVal = elem.value.replace(/,/g, '');
        if (!rawVal || isNaN(rawVal)) { calculateTax(); return; }
        elem.value = Math.round(rawVal).toLocaleString('en-IN');
        calculateTax();
    }

    function updateAndResize(id, value) {
        let elem = document.getElementById(id);
        if(elem) elem.innerText = value;
    }

    const d_now = new Date();
    document.getElementById('currentDate').innerText = `${String(d_now.getDate()).padStart(2,'0')}/${String(d_now.getMonth()+1).padStart(2,'0')}/${d_now.getFullYear()}`;

    function format(num) { return Math.round(num).toLocaleString('en-IN'); }

    function calculateTax() {
        const getVal = (id) => parseFloat(document.getElementById(id).value.replace(/,/g, '')) || 0;
        let gross = getVal('grossIncome'), relief89 = getVal('relief89'), paidTaxVal = getVal('paidTax'), paidCessVal = getVal('paidCess');
        let stdDed = 75000, taxable = Math.max(0, gross - stdDed);

        updateAndResize('headSalaries', format(taxable));
        updateAndResize('taxableIncome', format(taxable));

        let slabs = [
            { start: 0, limit: 400000, rate: 0, id: 1 },
            { start: 400000, limit: 800000, rate: 0.05, id: 2 },
            { start: 800000, limit: 1200000, rate: 0.10, id: 3 },
            { start: 1200000, limit: 1600000, rate: 0.15, id: 4 },
            { start: 1600000, limit: 2000000, rate: 0.20, id: 5 },
            { start: 2000000, limit: 2400000, rate: 0.25, id: 6 },
            { start: 2400000, limit: Infinity, rate: 0.30, id: 7 }
        ];

        let slabTaxTotal = 0, visibleRows = 0;
        slabs.forEach(s => {
            let row = document.getElementById(`row-slab-${s.id}`);
            if (taxable > s.start || s.id === 1) {
                row.style.display = 'table-row'; visibleRows++;
                let inc = Math.max(0, (s.limit === Infinity ? taxable : Math.min(taxable, s.limit)) - s.start);
                let tax = inc * s.rate; slabTaxTotal += tax;
                updateAndResize(`to-slab-${s.id}`, s.limit === Infinity ? format(taxable) : format(s.limit));
                updateAndResize(`inc-slab-${s.id}`, format(inc));
                updateAndResize(`tax-slab-${s.id}`, format(tax));
            } else row.style.display = 'none';
        });

        document.getElementById('slab-idx-cell').rowSpan = visibleRows + 2;
        document.getElementById('slab-title-cell').rowSpan = visibleRows + 2;
        updateAndResize('totalSlabTax', format(slabTaxTotal));

        let taxAfter87 = (taxable <= 1200000) ? 0 : slabTaxTotal;
        if (taxable > 1200000 && slabTaxTotal > (taxable - 1200000)) taxAfter87 = taxable - 1200000;

        updateAndResize('rebate87A', format(taxable <= 1200000 ? slabTaxTotal : 0));
        updateAndResize('marginalRelief87A', format(taxable > 1200000 ? Math.max(0, slabTaxTotal - taxAfter87) : 0));
        updateAndResize('taxAfterRelief', format(taxAfter87));

        let cess = Math.round(taxAfter87 * 0.04);
        updateAndResize('cess', format(cess));
        updateAndResize('totalTaxLiability', format(taxAfter87 + cess));

        let finalTax = Math.max(0, taxAfter87 - relief89);
        updateAndResize('balanceTaxComp', format(finalTax));
        updateAndResize('balanceCessComp', format(cess));
        updateAndResize('balanceTotalComp', format(finalTax + cess));
        
        let netTotal = (finalTax + cess) - (paidTaxVal + paidCessVal);
        updateAndResize('netTotal', format(netTotal));
        
        let status = document.getElementById('taxStatus');
        status.value = netTotal > 0 ? "Payable" : (netTotal < 0 ? "Refundable" : "Nil");
        status.style.color = netTotal > 0 ? "red" : (netTotal < 0 ? "green" : "black");
    }

    async function downloadPDF() {
        const overlay = document.getElementById('loadingOverlay');
        overlay.style.display = 'flex';
        const canvas = await html2canvas(document.getElementById('printContent'), { scale: 2 });
        const imgData = canvas.toDataURL('image/jpeg', 0.9);
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
        pdf.save("IncomeTax.pdf");
        overlay.style.display = 'none';
    }

    async function sharePDF() {
        const overlay = document.getElementById('loadingOverlay');
        overlay.style.display = 'flex';
        try {
            const canvas = await html2canvas(document.getElementById('printContent'), { scale: 2 });
            const imgData = canvas.toDataURL('image/jpeg', 0.85);
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
            const pdfBlob = pdf.output('blob');
            const file = new File([pdfBlob], "IncomeTax.pdf", { type: "application/pdf" });
            if (navigator.share) await navigator.share({ files: [file], title: 'Income Tax Sheet' });
        } catch (e) {} finally { overlay.style.display = 'none'; }
    }

    calculateTax();
</script>
</body>
</html>
